version: '3'
vars:
  PLUGIN_NAME: devex-plugin-package-manager-curlpipe
tasks:
  build:
    desc: Build package-manager-curlpipe plugin for all platforms
    cmds:
      - mkdir -p dist\n      - GOOS=darwin GOARCH=amd64 go build -ldflags="-s -w -X main.version={{.VERSION | default \"dev\"}}" -o dist/devex-plugin-package-manager-curlpipe-darwin-amd64 .\n      - GOOS=darwin GOARCH=arm64 go build -ldflags="-s -w -X main.version={{.VERSION | default \"dev\"}}" -o dist/devex-plugin-package-manager-curlpipe-darwin-arm64 .\n      - GOOS=linux GOARCH=amd64 go build -ldflags="-s -w -X main.version={{.VERSION | default \"dev\"}}" -o dist/devex-plugin-package-manager-curlpipe-linux-amd64 .\n      - GOOS=linux GOARCH=arm64 go build -ldflags="-s -w -X main.version={{.VERSION | default \"dev\"}}" -o dist/devex-plugin-package-manager-curlpipe-linux-arm64 .\n      - GOOS=windows GOARCH=amd64 go build -ldflags="-s -w -X main.version={{.VERSION | default \"dev\"}}" -o dist/devex-plugin-package-manager-curlpipe-windows-amd64.exe .\n      - GOOS=windows GOARCH=arm64 go build -ldflags="-s -w -X main.version={{.VERSION | default \"dev\"}}" -o dist/devex-plugin-package-manager-curlpipe-windows-arm64.exe .
  test:
    desc: Run tests
    cmds:
      - go test -v ./...
  lint:
    desc: Run linters
    cmds:
      - golangci-lint run
  install:local:
    desc: Install plugin locally for testing
    cmds:
      - task: build
      - mkdir -p ~/.devex/plugins
      - cp dist/\{{.PLUGIN_NAME}}-\{{OS}}-\{{ARCH}}* ~/.devex/plugins/\{{.PLUGIN_NAME}}
      - chmod +x ~/.devex/plugins/\{{.PLUGIN_NAME}}
  clean:
    desc: Clean build artifacts
    cmds:
      - rm -rf dist/
